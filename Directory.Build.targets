<Project>
  <PropertyGroup>
    <NuspecFile Condition=" Exists('$(MSBuildProjectDirectory)\$(MSBuildProjectName).nuspec') ">$(MSBuildProjectDirectory)\$(MSBuildProjectName).nuspec</NuspecFile>

    <!-- Full symbols so that unit test assertions have more info -->
    <DebugType Condition=" '$(Configuration)' == 'Debug' ">Full</DebugType>

    <GenerateNuspecDependsOn>$(GenerateNuspecDependsOn);SetNuSpecProperties</GenerateNuspecDependsOn>

    <GeneratePackageOnBuild Condition="'$(IsPackable)' != 'false'">true</GeneratePackageOnBuild>
  </PropertyGroup>

  <Target Name="SetNuSpecProperties" Condition=" Exists('$(NuspecFile)') ">
    <PropertyGroup>
      <NuspecProperties>
        id=$(PackageId);
        description=$(PackageDescription);
        version=$(PackageVersion);
        authors=$(Authors);
        copyright=$(Copyright);
        projecturl=$(PackageProjectUrl);
        licensefile=$(PackageLicenseFile);
        icon=$(PackageIconPath);
        tags=$(PackageTags);
        packagetype=MSBuildSdk
      </NuspecProperties>
    </PropertyGroup>
  </Target>

  <Target Name="AddInternalsVisibleToAssemblyAttribute"
          BeforeTargets="BeforeCompile"
          Condition="@(InternalsVisibleTo->Count()) > 0">
    <ItemGroup>
      <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
        <_Parameter1 Condition="'$(SignType)' == 'Test' Or '$(SignType)' == 'Real'">%(InternalsVisibleTo.Identity), PublicKey=002400000480000094000000060200000024000052534131000400000100010007d1fa57c4aed9f0a32e84aa0faefd0de9e8fd6aec8f87fb03766c834c99921eb23be79ad9d5dcc1dd9ad236132102900b723cf980957fc4e177108fc607774f29e8320e92ea05ece4e821c0a5efe8f1645c4c0c93c1ab99285d622caa652c1dfad63d745d6f2de5f17e5eaf0fc4963d261c8a12436518206dc093344d5ad293</_Parameter1>
        <_Parameter1 Condition="'$(SignType)' == ''">%(InternalsVisibleTo.Identity)</_Parameter1>
      </AssemblyAttribute>
    </ItemGroup>
  </Target>

  <Import Project="Sdk.targets" Sdk="Microsoft.Build.CentralPackageVersions" />
</Project>
